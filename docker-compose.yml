flask:
  build: .
  command: echo python manage.py runserver --host 0.0.0.0 --port 5000 --debug --reload
  volumes:
    - .:/dontforget
  ports:
    - "6660:5000"

telegram:
  build: .
  command: python manage.py telegram
  links:
    - postgresql
  volumes:
    - .:/dontforget
  environment:
    - DONTFORGET_ENV=prod
    - UI_MODULE_NAME=telegram_bot  # Docker doesn't work with Cocoa Dialog as UI

postgresql:
  # Official PostgreSQL image
  # https://registry.hub.docker.com/u/library/postgres/
  #
  # To run the database initialization again, you have to remove the containers and images. Use this command:
  # docker rm -f $(docker ps -a | grep -i dontforget_postgresql | awk '{print $1}')
  # docker rmi -f dontforget_postgresql
  #
  # To load data from SQLite, run this command:
  # ./manage.py db_refresh && pgloader -v docker/postgres/sqlite.load
  #
  # http://pgloader.io/howto/pgloader.1.html
  # https://github.com/dimitri/pgloader
  image: postgres:9.6.2
  environment:
    - POSTGRES_USER=dontforget
    - POSTGRES_PASSWORD=dontforget
  # https://docs.docker.com/compose/compose-file/#/expose
  expose:
    - "5432"
  # https://docs.docker.com/compose/compose-file/#/ports
  ports:
    - "5433:5432"
  volumes:
    - ./docker/postgres:/docker-entrypoint-initdb.d
